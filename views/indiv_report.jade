extends layout

block css
	link(rel="stylesheet" href="/font-awesome/css/font-awesome.min.css")
	- tabletheme = "sortable-theme-bootstrap"
	link(rel='stylesheet', href='/stylesheets/#{tabletheme}.css')

block content
	.container
		.row
			.col-xs-12
				h1 Diagnostic Predictive Scales (DPS) Report
				p The DPS is a screen, and is not diagnostic. It is not a substitute for a thorough clinical evaluation.
				p In any of the tables, click a column header to sort with it.
				a.btn.btn-secondary(href="/report") 
					i.fa.fa-chevron-left(aria-hidden="true")
					|  Back to all reports

		.row.m-t-3
			-
				col1   = "col-sm-4"
				col2   = "col-sm-8"
				report = JSON.parse(report)
			div(class="#{col1}")
				h2 Report for #{report.subjectID}
				-
					optionalSections = ["site", "sponsor", "protocol", "description"]
				br 
				each section in optionalSections
					//- Square bracket notation allows selection of properties using variables
					if report[section] 
						h4 #{section.charAt(0).toUpperCase() + section.slice(1)}: #{report[section]}
				h4 Language: #{report.language}
				br
				.btn-group
					a.btn.btn-secondary#print Print Report
					a.btn.btn-secondary#save Save Report
			div(class="#{col2}")
				-
					one   = 6
					two   = 4
					three = 12 - one - two
					dpsScore = 0
					var col = function(num) { 
						return 'col-xs-' + num
					}
				each section in report.formResponses
					h3= section.name
					table.table.table-striped(class="#{tabletheme}" data-sortable)
						- conc = section.name === "Conclusion"
						thead
							tr
								th(class="#{col(one)}") Question
								if conc
									th(class="#{col(12 - one)}") Answer
								else
									th(class="#{col(two)}") Answer
									th(class="#{col(three)}") Score
						tbody
							-
								questionNum  = 1
								sectionScore = 0
							each response in section.qa
								tr
									td(class="#{col(one)}") #{questionNum}. #{response.question}
									td(class="#{col(two)}") #{response.answer}
									- placeholder = response.answer.length % 2; //- placeholder number
									td(class="#{col(three)}") 
										if !conc
											=placeholder
								-
									questionNum++
									sectionScore += placeholder //- placeholder number
					table.table
						tr
							td(class="#{col(one + two)}")
								if !conc 
									b #{section.name} Score
							td(class="#{col(three)}") 
								if !conc
									=sectionScore
						- dpsScore += sectionScore
				table.table
					tr
						td(class="#{col(one)}")
						td(class="#{col(two)}") 
							h4 Total DPS Score
						td(class="#{col(three)}") 
							h4 #{dpsScore}


block scripts
	script(src='/javascripts/libraries/sortable.min.js')